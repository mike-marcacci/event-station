/*
 * Event-Station
 *
 * Copyright (c) 2015 Morris Allison III <author@morris.xyz> (http://morris.xyz)
 * Released under the MIT License.
 *
 * For the full copyright and license information, please view
 * the LICENSE file distributed with this source code.
 *
 * @preserve
 */
!function(t,e){if("object"==typeof module&&"object"==typeof module.exports){var r=e(require,exports);void 0!==r&&(module.exports=r)}else"function"==typeof define&&define.amd?define(t,e):"object"==typeof self&&(self.EventStation=e())}(["require","exports"],function(t,e){"use strict";function r(){return String(++j)}function n(t){void 0===t&&(t={});var e,n=A;return{stationId:r(),listenerCount:0,hearingCount:0,listenersMap:Object.create(null),heardStations:Object.create(null),isPropagationStopped:!1,emitAllEvent:t.emitAllEvent===e?n.emitAllEvent:t.emitAllEvent,enableRegExp:t.enableRegExp===e?n.enableRegExp:t.enableRegExp,regExpMarker:t.regExpMarker===e?n.regExpMarker:t.regExpMarker,enableDelimiter:t.enableDelimiter===e?n.enableDelimiter:t.enableDelimiter,delimiter:t.delimiter===e?n.delimiter:t.delimiter}}function i(t,e){var r=e.eventName,n=t.listenersMap;void 0===n[r]&&(n[r]=[]);var i=e.stationMetas;void 0===i?e.stationMetas=[t]:i.push(t),n[r].push(e),t.listenerCount++;var o=e.hearer;void 0!==o&&o.stationMeta.hearingCount++}function o(t,e,r){if(!(t.listenerCount<1)){var n=t.listenersMap,i=e.eventName,o=n[i];if(void 0!==o){var a=o.length;if(1===a){if(!l(e,o[0],r))return;return delete n[i],t.listenerCount--,k(e),void O(t,e)}for(var s=0,u=a;u>s;s++){var c=o[s];l(e,c,r)&&(o.splice(s,1),t.listenerCount--,s--,u--,k(e),O(t,e))}o.length<1&&delete n[i]}}}function a(t,e,r){var n,i=t.listenersMap,o=e.eventName;if(void 0===o)n=d(t);else if(n=i[o],void 0===n)return!1;return f(e,n,r)}function s(t,e,r){for(var n=0,i=e.length;i>n;n++)if(a(t,e[n],r))return!0;return!1}function u(t){return void 0!==t.stationMetas}function c(t){for(var e=0,r=t.length;r>e;e++)if(u(t[e]))return!0;return!1}function l(t,e,r){if(r===!0)return t==e;var n=t.matchCallback;if(void 0!==n&&n!==e.matchCallback)return!1;var i=t.matchContext;if(void 0!==i&&i!==e.matchContext)return!1;var o=t.hearer;if(void 0!==o&&o!==e.hearer)return!1;var a=t.eventName;return void 0!==a&&a!==e.eventName?!1:!0}function f(t,e,r){var n=e.length;if(1>n)return!1;for(var i=0;n>i;i++){var o=e[i];if(l(t,o,r))return!0}return!1}function h(t,e,r){var n=e.length,i=r.stationMeta;i.isPropagationStopped=!1;for(var o=0,a=t.length;a>o;o++){if(i.isPropagationStopped)return void(i.isPropagationStopped=!1);var s=t[o];if(!s.isPaused){var u=s.callback,c=s.context;switch(n){case 0:u.call(c);break;case 1:u.call(c,e[0]);break;case 2:u.call(c,e[0],e[1]);break;case 3:u.call(c,e[0],e[1],e[2]);break;default:u.apply(c,e)}var l=s.resolves;if(void 0!==l){for(var f=0,h=l.length;h>f;f++)l[f](s);s.resolves=void 0}var v=s.maxOccurrences,p=s.occurrences;void 0!==v&&(p=void 0===p?s.occurrences=1:++s.occurrences,p===v&&C(s))}}}function v(t){if(void 0===L)throw new Error("No promise implementation detected.");return new L(function(e){void 0===t.resolves?t.resolves=[e]:t.resolves.push(e)})}function p(t){if(void 0!==t.hearer)throw new Error("Cross-emitter listeners can not be cloned.");return{eventName:t.eventName,callback:t.callback,context:t.context,matchCallback:t.matchCallback,matchContext:t.matchContext,isPaused:t.isPaused,occurrences:t.occurrences,maxOccurrences:t.maxOccurrences}}function d(t){if(t.listenerCount<1)return[];var e=t.listenersMap,r=[];for(var n in e)r=r.concat(e[n]);return r}function g(t){var e=[],r=t.heardStations;for(var n in r)e.push(r[n]);return e}function m(t,e){if(void 0===e)return g(t);if(Array.isArray(e))return e;if(void 0!==e.stationMeta)return[e];throw new Error("Invalid target")}function b(t,e,r,n,i){if("string"==typeof r){var o=t.stationMeta,a=o.enableDelimiter,s=o.delimiter;return a&&r.indexOf(s)>=0?(r=r.split(s),M(t,e,r,n,i)):[{eventName:r,callback:n,context:e||void 0!==i?i:t,matchCallback:n,matchContext:i}]}if(Array.isArray(r))return M(t,e,r,n,i);if("object"==typeof r)return y(t,e,r,n);throw new Error("Invalid arguments")}function y(t,e,r,n){var i=[];for(var o in r)i.push({eventName:o,callback:r[o],context:e||void 0!==n?n:t,matchCallback:r[o],matchContext:n});return i}function M(t,e,r,n,i){for(var o=[],a=0,s=r.length;s>a;a++)o.push({eventName:r[a],callback:n,context:e||void 0!==i?i:t,matchContext:i,matchCallback:n});return o}function x(t,e,r){var n=[];for(var i in e)0===i.indexOf(r)?new RegExp(i.substr(1)).test(t)&&(n=n.concat(e[i])):i===t&&(n=n.concat(e[t]));return n}function C(t){for(var e=t.stationMetas,r=0,n=e.length;n>r;r++)o(e[r],t,!0)}function E(t,e){var r=e.listenersMap,n=r[t];if(void 0!==n){for(var i=n.length,o=0;i>o;o++){var a=n[o],s=a.hearer;void 0!==s&&s.stationMeta.hearingCount--}e.listenerCount=e.listenerCount-i,delete r[t]}}function w(t){var e=t.listenersMap;for(var r in e)for(var n=e[r],i=0,o=n.length;o>i;i++){var a=n[i],s=a.hearer;void 0!==s&&s.stationMeta.hearingCount--}t.listenerCount=0,t.listenersMap=Object.create(null)}function P(t){var e=Object.create(null),r=t.stationMeta.heardStations;for(var n in r){var i=r[n];a(i.stationMeta,{hearer:t})&&(e[n]=i)}t.stationMeta.heardStations=e}function k(t){var e=t.hearer;void 0!==e&&e.stationMeta.hearingCount--}function O(t,e){var r=e.stationMetas;if(void 0!==r){var n=r.length;if(1===n)return void(r[0]===t&&(e.stationMetas=void 0));for(var i=[],o=0;n>o;o++){var a=r[o];a!==t&&i.push(a)}i.length<1?e.stationMetas=void 0:e.stationMetas=i}}var S,S=function(){function t(e){t.init(this,e)}return Object.defineProperty(t.prototype,"stationId",{get:function(){return this.stationMeta.stationId},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"listenerCount",{get:function(){return this.stationMeta.listenerCount},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hearingCount",{get:function(){return this.stationMeta.hearingCount},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"listenerEventNames",{get:function(){return Object.getOwnPropertyNames(this.stationMeta.listenersMap)},enumerable:!0,configurable:!0}),t.prototype.on=function(e,r,n){for(var o=this.stationMeta,a=b(this,!1,e,r,n),s=0,u=a.length;u>s;s++)i(o,a[s]);return new t.Listeners(this,a)},t.prototype.once=function(t,e,r){return this.on(t,e,r).occur(1)},t.prototype.off=function(t,e,r){var n=this.stationMeta;if(!(n.listenerCount<1)){if(void 0===t)return void w(n);if(void 0===e&&void 0===r&&"string"==typeof t&&(!n.enableDelimiter||t.indexOf(n.delimiter)<0))return void E(t,n);for(var i=b(this,!0,t,e,r),a=0,s=i.length;s>a;a++)o(n,i[a])}},t.prototype.hear=function(e,r,n,o){for(var a=this.stationMeta.heardStations,s=b(this,!1,r,n,o),u=e.stationMeta,c=0,l=s.length;l>c;c++){var f=s[c];f.hearer=this,i(u,f),a[e.stationId]=e}return new t.Listeners(e,s)},t.prototype.hearOnce=function(t,e,r,n){return this.hear(t,e,r,n).occur(1)},t.prototype.disregard=function(t,e,r,n){var i=this.stationMeta;if(!(i.hearingCount<1)){var a,s=!1;void 0===e?s=!0:a=b(this,!0,e,r,n);for(var u=m(i,t),c=0,l=u.length;l>c;c++){var f=u[c],h=f.stationMeta;s&&(e=f.listenerEventNames,a=b(this,!0,e,r,n));for(var v=0,p=a.length;p>v;v++){var d=a[v];d.hearer=this,o(h,d)}}s?i.heardStations=Object.create(null):P(this)}},t.prototype.isHeard=function(t,e,r){var n=this.stationMeta,i=n.listenerCount;if(1>i)return!1;if(arguments.length<1)return i>0;for(var o=b(this,!0,t,e,r),s=0,u=o.length;u>s;s++)if(a(n,o[s]))return!0;return!1},t.prototype.isHearing=function(t,e,r,n){var i=this.stationMeta;if(i.hearingCount<1)return!1;var o,s=m(i,t),u=!1;void 0===e?u=!0:o=b(this,!0,e,r,n);for(var c=0,l=s.length;l>c;c++){var f=s[c],h=f.stationMeta;u&&(e=f.listenerEventNames,o=b(this,!0,e,r,n));for(var v=0,p=o.length;p>v;v++){var d=o[v];if(d.hearer=this,a(h,d))return!0}}return!1},t.prototype.emit=function(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];var n=this.stationMeta;if(!(n.listenerCount<1)){var i;if("string"==typeof t){var o=n.enableDelimiter,a=n.delimiter;i=o&&t.indexOf(a)>=0?t.split(a):[t]}else{if(!Array.isArray(t))throw new Error("Invalid first argument");i=t}var s,u=n.listenersMap,c=n.regExpMarker,l=n.enableRegExp;n.emitAllEvent&&(s=u.all);for(var f=this,v=0,p=i.length;p>v;v++){var d=i[v],g=void 0;if(g=l?x(d,u,c):u[d],void 0!==g&&h(g,e,f),void 0!==s){var m=e.slice();m.splice(0,0,d),h(s,m,f)}}}},t.prototype.makeListeners=function(e,r,n){var i=b(this,!1,e,r,n);return new t.Listeners(this,i)},t.prototype.getListeners=function(e,r,n){var i=d(this.stationMeta),o=i.length;if(1>o)return void 0;if(arguments.length<1)return new t.Listeners(this,i);for(var a=b(this,!0,e,r,n),s=[],u=0;o>u;u++)for(var c=i[u],f=0,h=a.length;h>f;f++){var v=a[f];if(l(v,c)){s.push(c);break}}return s.length<1?void 0:new t.Listeners(this,s)},t.prototype.toObservable=function(t,e,r){var n=this;if(void 0===N)throw new Error("Rx has not been injected. See documentation for details.");return N.fromEventPattern(function(r){n.on(t,r,e)},function(r){n.off(t,r,e)},r)},t.prototype.stopPropagation=function(){this.stationMeta.isPropagationStopped=!0},t.prototype.addListener=function(t){i(this.stationMeta,t)},t.prototype.removeListener=function(t,e){o(this.stationMeta,t,e)},t.prototype.hasListener=function(t,e){return a(this.stationMeta,t,e)},t}();!function(t){function e(t,e){t.stationMeta=n(e)}function r(e){for(var r in A)A[r]=e[r];return t}function a(e,r){if("rx"===e)N=r.Observable;else{if("Promise"!==e)throw new Error("Invalid name");L=r}return t}function u(e){var r=t.prototype;for(var n in r){var i=Object.getOwnPropertyDescriptor(r,n),o={configurable:!0};void 0!==i.get?o.get=i.get:o.value=i.value,Object.defineProperty(e,n,o)}return e}t.init=e,t.config=r,t.inject=a,t.extend=u;var l=function(){function t(t,e){this.originStation=t,this.listeners=e}return Object.defineProperty(t.prototype,"count",{get:function(){return this.listeners.length},enumerable:!0,configurable:!0}),t.prototype.occur=function(t){if(1>t)throw new Error("The maximum occurrences must be greater than or equal to one.");for(var e=this.listeners,r=0,n=e.length;n>r;r++)e[r].maxOccurrences=t;return this},t.prototype.calling=function(t){for(var e=this.listeners,r=0,n=e.length;n>r;r++){var i=e[r];i.callback=t,i.matchCallback=t}return this},t.prototype.once=function(t){return this.calling(t).occur(1)},t.prototype.off=function(){for(var t=this.listeners,e=0,r=t.length;r>e;e++)C(t[e]);return this},t.prototype.using=function(t){for(var e=this.listeners,r=0,n=e.length;n>r;r++){var i=e[r];i.context=t,i.matchContext=t}return this},t.prototype.addTo=function(t){for(var e=this.listeners,r=t.stationMeta,n=0,o=e.length;o>n;n++){var a=e[n];if(void 0!==a.hearer)throw new Error("Cross-emitter listeners can only be attached to one emitter.");i(r,a)}return this},t.prototype.removeFrom=function(t){for(var e=this.listeners,r=t.stationMeta,n=0,i=e.length;i>n;n++)o(r,e[n],!0);return this},t.prototype.moveTo=function(t){return this.removeFrom(this.originStation),this.originStation=t,this.addTo(t),this},t.prototype.has=function(t,e){return f(t,this.listeners,e)},t.prototype.attach=function(){return this.addTo(this.originStation)},t.prototype.detach=function(){return this.removeFrom(this.originStation)},t.prototype.isAttachedTo=function(t){return void 0===t?c(this.listeners):s(t.stationMeta,this.listeners,!0)},t.prototype.isAttached=function(){return this.isAttachedTo(this.originStation)},t.prototype.pause=function(){for(var t=this.listeners,e=0,r=t.length;r>e;e++)t[e].isPaused=!0;return this},t.prototype.resume=function(){for(var t=this.listeners,e=0,r=t.length;r>e;e++)t[e].isPaused=!1;return this},t.prototype.isPaused=function(){for(var t=this.listeners,e=0,r=t.length;r>e;e++)if(t[e].isPaused)return!0;return!1},t.prototype.toPromises=function(){for(var t=[],e=this.listeners,r=0,n=e.length;n>r;r++)t[r]=v(e[r]);return t},t.prototype.all=function(){return L.all(this.toPromises())},t.prototype.race=function(){return L.race(this.toPromises())},t.prototype.reset=function(){for(var t=this.listeners,e=0,r=t.length;r>e;e++){var n=t[e];n.occurrences=void 0,n.isPaused=void 0}return this},t.prototype.forEach=function(t){for(var e=this.listeners,r=0,n=e.length;n>r;r++)t(e[r],r,e);return this},t.prototype.get=function(t){return this.listeners[t]},t.prototype.index=function(t){for(var e=this.listeners,r=0,n=e.length;n>r;r++)if(e[r]===t)return r;return void 0},t.prototype.clone=function(){for(var e=[],r=this.listeners,n=0,i=r.length;i>n;n++)e[n]=p(r[n]);return new t(this.originStation,e)},t}();t.Listeners=l}(S||(S={}));var j=0,A=Object.create(null);A.emitAllEvent=!0,A.enableRegExp=!1,A.regExpMarker="%",A.enableDelimiter=!0,A.delimiter=" ";var N,L=Promise;return S});
//# sourceMappingURL=event-station.min.js.map