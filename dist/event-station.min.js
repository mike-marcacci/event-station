/*
 * event-station v1.1.0-beta.2
 * Copyright (c) 2016 Morris Allison III <author@morris.xyz> (http://morris.xyz)
 * Released under the MIT/Expat license
 * @preserve
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define("event-station",["exports"],e):e(t.EventStation=t.EventStation||{})}(this,function(t){"use strict";function e(t,e){var r=e.eventName,n=t.listenersMap;n[r]||(n[r]=[]);var i=e.stationMetas;i?i.push(t):e.stationMetas=[t],n[r].push(e),t.listenerCount++;var o=e.hearer;o&&o.stationMeta.hearingCount++}function r(t,e,r){if(r===!0)return t==e;var n=t.matchCallback;if(n&&n!==e.matchCallback)return!1;var i=t.matchContext;if(void 0!==i&&i!==e.matchContext)return!1;var o=t.hearer;if(o&&o!==e.hearer)return!1;var a=t.eventName;return void 0===a||a===e.eventName}function n(t,e,n){if(!(t.listenerCount<1)){var a=t.listenersMap,s=e.eventName,u=a[s];if(u){var c=u.length;if(1===c){if(!r(e,u[0],n))return;return delete a[s],t.listenerCount--,o(e),void i(t,e)}for(var f=0,l=c;f<l;f++){var h=u[f];r(e,h,n)&&(u.splice(f,1),t.listenerCount--,f--,l--,o(e),i(t,e))}u.length<1&&delete a[s]}}}function i(t,e){var r=e.stationMetas;if(r){if(1===r.length)return void(e.stationMetas=void 0);for(var n=[],i=0,o=r;i<o.length;i++){var a=o[i];a!==t&&n.push(a)}n.length<1?e.stationMetas=void 0:e.stationMetas=n}}function o(t){var e=t.hearer;e&&e.stationMeta.hearingCount--}function a(t){var e=t.stationMetas;if(e)for(var r=0,i=e;r<i.length;r++){var o=i[r];n(o,t,!0)}}function s(t,e,r,n){var i=n.length,o=e.stationMeta;o.isPropagationStopped=!1;for(var s,u=[],c=0,f=t;c<f.length;c++){var l=f[c];if(o.isPropagationStopped)return void(o.isPropagationStopped=!1);if(!l.isPaused){var h=l.callback,v=l.context;if(h)switch(i){case 0:s=h.call(v);break;case 1:s=h.call(v,n[0]);break;case 2:s=h.call(v,n[0],n[1]);break;case 3:s=h.call(v,n[0],n[1],n[2]);break;default:s=h.apply(v,n)}r&&s&&"function"==typeof s.then&&"function"==typeof s.catch&&u.push(s);var p=l.resolves;if(p){for(var g=0,d=p;g<d.length;g++){var m=d[g];m(l)}l.resolves=void 0}var b=l.maxOccurrences,y=l.occurrences;void 0!==b&&(y=void 0===y?l.occurrences=1:++l.occurrences,y===b&&a(l))}}return u}function u(t){if(t.listenerCount<1)return[];var e=t.listenersMap,r=[];for(var n in e)r=r.concat(e[n]);return r}function c(t,e,n){var i=e.length;if(i<1)return!1;for(var o=0,a=e;o<a.length;o++){var s=a[o];if(r(t,s,n))return!0}return!1}function f(t,e,r){var n,i=t.listenersMap,o=e.eventName;if(void 0===o)n=u(t);else if(n=i[o],!n)return!1;return c(e,n,r)}function l(t,e){switch(t){case"rx":T.$RxObservable=e?e.Observable:e;break;case"Promise":T.$Promise=e;break;default:throw new Error("Invalid name")}}function h(){T.$RxObservable=void 0,T.$Promise=L}function v(t){if(!T.$Promise)throw new Error("No promises implementation available.");return new T.$Promise(function(e){t.resolves?t.resolves.push(e):t.resolves=[e]})}function p(t){if(t.hearer)throw new Error("Cross-emitter listeners can not be cloned.");return{eventName:t.eventName,callback:t.callback,context:t.context,matchCallback:t.matchCallback,matchContext:t.matchContext,isPaused:t.isPaused,occurrences:t.occurrences,maxOccurrences:t.maxOccurrences}}function g(t){for(var e=0,r=t;e<r.length;e++){var n=r[e];if(d(n))return!0}return!1}function d(t){return void 0!==t.stationMetas}function m(t,e,r){for(var n=0,i=e;n<i.length;n++){var o=i[n];if(f(t,o,r))return!0}return!1}function b(){return String(++H)}function y(){w(q,_)}function M(t){var e=w({},q,t);x(e),w(q,t)}function x(t){if(""===t.delimiter)throw new Error("Invalid option: Delimiters can't be empty strings.");if(""===t.regExpMarker)throw new Error("Invalid option: RegExp markers can't be empty strings.");if(t.regExpMarker&&t.delimiter&&t.regExpMarker.indexOf(t.delimiter)>=0)throw new Error("Invalid option: RegExp markers can't contain the delimiter string.")}function w(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];for(var n=1;n<arguments.length;n++){var i=arguments[n];for(var o in _){var a=_.hasOwnProperty(o),s=i[o];a&&null!=s&&(t[o]=s)}}return t}function C(t,e){var r;if("string"==typeof t){var n=e.delimiter;r=e.enableDelimiter&&n?t.split(n):[t]}else{if(!Array.isArray(t))throw new Error("Invalid first argument");r=t}return r}function P(t){void 0===t&&(t={});var e={heardStations:Object.create(null),hearingCount:0,isPropagationStopped:!1,listenerCount:0,listenersMap:Object.create(null),stationId:b()},r=w(e,q,t);return x(r),r}function O(t,e,r,n,i){if("string"==typeof r){var o=t.stationMeta,a=o.enableDelimiter,s=o.delimiter;return a&&r.indexOf(s)>=0?(r=r.split(s),k(t,e,r,n,i)):[{eventName:r,callback:n,context:e||void 0!==i?i:t,matchCallback:n,matchContext:i}]}if(Array.isArray(r))return k(t,e,r,n,i);if("object"==typeof r)return E(t,e,r,n);throw new Error("Invalid arguments")}function E(t,e,r,n){var i=[];for(var o in r)i.push({eventName:o,callback:r[o],context:e||void 0!==n?n:t,matchCallback:r[o],matchContext:n});return i}function k(t,e,r,n,i){for(var o=[],a=0,s=r.length;a<s;a++)o.push({eventName:r[a],callback:n,context:e||void 0!==i?i:t,matchContext:i,matchCallback:n});return o}function S(t,e,r,n){var i,o=e.stationMeta,a=o.listenersMap;i=o.enableRegExp?j(t,a,o.regExpMarker):a[t];var u=[];if(i){var c=s(i,e,r,n);r&&c&&(u=u.concat(c))}var f=a.all;if(o.emitAllEvent&&f){var l=n.slice();l.splice(0,0,t);var c=s(f,e,r,l);r&&c&&(u=u.concat(c))}return u}function j(t,e,r){var n=[];for(var i in e)0===i.indexOf(r)?new RegExp(i.substr(r.length)).test(t)&&(n=n.concat(e[i])):i===t&&(n=n.concat(e[t]));return n}function N(t){var e=Object.create(null),r=t.stationMeta.heardStations;for(var n in r){var i=r[n];f(i.stationMeta,{hearer:t})&&(e[n]=i)}t.stationMeta.heardStations=e}function $(t){var e=t.listenersMap;for(var r in e)for(var n=e[r],i=0,o=n;i<o.length;i++){var a=o[i],s=a.hearer;s&&s.stationMeta.hearingCount--}t.listenerCount=0,t.listenersMap=Object.create(null)}function A(t,e){var r=e.listenersMap,n=r[t];if(void 0!==n){for(var i=n.length,o=0;o<i;o++){var a=n[o],s=a.hearer;s&&s.stationMeta.hearingCount--}e.listenerCount=e.listenerCount-i,delete r[t]}}function I(t,e){if(void 0===e)return R(t);if(Array.isArray(e))return e;if(e.stationMeta)return[e];throw new Error("Invalid target")}function R(t){var e=[],r=t.heardStations;for(var n in r)e.push(r[n]);return e}var T,D="undefined"!=typeof window?window:global,L=D.Promise;!function(t){t.$RxObservable=void 0,t.$Promise=L}(T||(T={}));var F=function(){function t(t,e){this.originStation=t,this.listeners=e}return Object.defineProperty(t.prototype,"count",{get:function(){return this.listeners.length},enumerable:!0,configurable:!0}),t.prototype.occur=function(t){if(t<1)throw new Error("The maximum occurrences must be greater than or equal to one.");for(var e=this.listeners,r=0,n=e;r<n.length;r++){var i=n[r];i.maxOccurrences=t}return this},t.prototype.calling=function(t){for(var e=this.listeners,r=0,n=e;r<n.length;r++){var i=n[r];i.callback=t,i.matchCallback=t}return this},t.prototype.once=function(t){return this.calling(t).occur(1)},t.prototype.off=function(){for(var t=this.listeners,e=0,r=t;e<r.length;e++){var n=r[e];a(n)}return this},t.prototype.using=function(t){for(var e=this.listeners,r=0,n=e;r<n.length;r++){var i=n[r];i.context=t,i.matchContext=t}return this},t.prototype.addTo=function(t){for(var r=this.listeners,n=t.stationMeta,i=0,o=r;i<o.length;i++){var a=o[i],s=a.crossOrigin;if(s&&s!==t)throw new Error("Cross-emitter listeners can only be attached to their origin station.");e(n,a)}return this},t.prototype.removeFrom=function(t){for(var e=this.listeners,r=t.stationMeta,i=0,o=e;i<o.length;i++){var a=o[i];n(r,a,!0)}return this},t.prototype.moveTo=function(t){return this.removeFrom(this.originStation),this.originStation=t,this.addTo(t),this},t.prototype.has=function(t,e){return c(t,this.listeners,e)},t.prototype.attach=function(){return this.addTo(this.originStation)},t.prototype.detach=function(){return this.removeFrom(this.originStation)},t.prototype.isAttachedTo=function(t){return t?m(t.stationMeta,this.listeners,!0):g(this.listeners)},t.prototype.isAttached=function(){return this.isAttachedTo(this.originStation)},t.prototype.pause=function(){for(var t=this.listeners,e=0,r=t;e<r.length;e++){var n=r[e];n.isPaused=!0}return this},t.prototype.resume=function(){for(var t=this.listeners,e=0,r=t;e<r.length;e++){var n=r[e];n.isPaused=!1}return this},t.prototype.isPaused=function(){for(var t=this.listeners,e=0,r=t;e<r.length;e++){var n=r[e];if(n.isPaused)return!0}return!1},t.prototype.toPromises=function(){for(var t=[],e=this.listeners,r=0,n=e.length;r<n;r++){var i=e[r];t[r]=v(i)}return t},t.prototype.all=function(){return T.$Promise.all(this.toPromises())},t.prototype.race=function(){return T.$Promise.race(this.toPromises())},t.prototype.reset=function(){for(var t=this.listeners,e=0,r=t;e<r.length;e++){var n=r[e];n.occurrences=void 0,n.isPaused=void 0}return this},t.prototype.forEach=function(t){for(var e=this.listeners,r=0,n=e.length;r<n;r++){var i=e[r];t(i,r,e)}return this},t.prototype.get=function(t){return this.listeners[t]},t.prototype.index=function(t){for(var e=this.listeners,r=0,n=e.length;r<n;r++)if(t===e[r])return r},t.prototype.clone=function(){var e=this.listeners.map(p);return new t(this.originStation,e)},t}(),H=0,_={delimiter:" ",emitAllEvent:!0,enableDelimiter:!0,enableRegExp:!1,regExpMarker:"%"},q=w({},_),z=function(){function t(e){t.init(this,e)}return Object.defineProperty(t.prototype,"stationId",{get:function(){return this.stationMeta.stationId},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"listenerCount",{get:function(){return this.stationMeta.listenerCount},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hearingCount",{get:function(){return this.stationMeta.hearingCount},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"listenerEventNames",{get:function(){return Object.getOwnPropertyNames(this.stationMeta.listenersMap)},enumerable:!0,configurable:!0}),t.prototype.on=function(t,r,n){for(var i=this.stationMeta,o=O(this,!1,t,r,n),a=0,s=o;a<s.length;a++){var u=s[a];e(i,u)}return new F(this,o)},t.prototype.once=function(t,e,r){return this.on(t,e,r).occur(1)},t.prototype.off=function(t,e,r){var i=this.stationMeta;if(!(i.listenerCount<1)){if(void 0===t)return void $(i);if(void 0===e&&void 0===r&&"string"==typeof t&&(!i.enableDelimiter||t.indexOf(i.delimiter)<0))return void A(t,i);for(var o=O(this,!0,t,e,r),a=0,s=o;a<s.length;a++){var u=s[a];n(i,u)}}},t.prototype.hear=function(t,r,n,i){for(var o=this.stationMeta.heardStations,a=O(this,!1,r,n,i),s=t.stationMeta,u=0,c=a;u<c.length;u++){var f=c[u];f.hearer=this,f.crossOrigin=t,e(s,f),o[t.stationId]=t}return new F(t,a)},t.prototype.hearOnce=function(t,e,r,n){return this.hear(t,e,r,n).occur(1)},t.prototype.disregard=function(t,e,r,i){var o=this.stationMeta;if(!(o.hearingCount<1)){var a=!1,s=[];void 0===e?a=!0:s=O(this,!0,e,r,i);for(var u=I(o,t),c=0,f=u.length;c<f;c++){var l=u[c],h=l.stationMeta;a&&(e=l.listenerEventNames,s=O(this,!0,e,r,i));for(var v=0,p=s;v<p.length;v++){var g=p[v];g.hearer=this,n(h,g)}}a?o.heardStations=Object.create(null):N(this)}},t.prototype.isHeard=function(t,e,r){var n=this.stationMeta,i=n.listenerCount;if(i<1)return!1;if(arguments.length<1)return i>0;for(var o=O(this,!0,t,e,r),a=0,s=o;a<s.length;a++){var u=s[a];if(f(n,u))return!0}return!1},t.prototype.isHearing=function(t,e,r,n){var i=this.stationMeta;if(i.hearingCount<1)return!1;var o=I(i,t),a=!1,s=[];e?s=O(this,!0,e,r,n):a=!0;for(var u=0,c=o.length;u<c;u++){var l=o[u],h=l.stationMeta;a&&(e=l.listenerEventNames,s=O(this,!0,e,r,n));for(var v=0,p=s;v<p.length;v++){var g=p[v];if(g.hearer=this,f(h,g))return!0}}return!1},t.prototype.emit=function(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];var n=this.stationMeta;if(!(n.listenerCount<1))for(var i=C(t,n),o=0,a=i;o<a.length;o++){var s=a[o];S(s,this,!1,e)}},t.prototype.emitAsync=function(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];if(!T.$Promise)throw new Error("No promises implementation available.");var n=this.stationMeta;if(n.listenerCount<1)return T.$Promise.resolve([]);for(var i=C(t,n),o=[],a=0,s=i;a<s.length;a++){var u=s[a];o=o.concat(S(u,this,!0,e))}return o.length>0?T.$Promise.all(o):T.$Promise.resolve([])},t.prototype.makeListeners=function(t,e,r){var n=O(this,!1,t,e,r);return new F(this,n)},t.prototype.getListeners=function(t,e,n){var i=u(this.stationMeta);if(!(i.length<1)){if(arguments.length<1)return new F(this,i);for(var o=O(this,!0,t,e,n),a=[],s=0,c=i;s<c.length;s++)for(var f=c[s],l=0,h=o;l<h.length;l++){var v=h[l];if(r(v,f)){a.push(f);break}}if(!(a.length<1))return new F(this,a)}},t.prototype.toObservable=function(t,e,r){var n=this;if(!T.$RxObservable)throw new Error("Rx has not been injected. See documentation for details.");return T.$RxObservable.fromEventPattern(function(r){n.on(t,r,e)},function(r){n.off(t,r,e)},r)},t.prototype.stopPropagation=function(){this.stationMeta.isPropagationStopped=!0},t.prototype.addListener=function(t){e(this.stationMeta,t)},t.prototype.removeListener=function(t,e){n(this.stationMeta,t,e)},t.prototype.hasListener=function(t,e){return f(this.stationMeta,t,e)},t.init=function(e,r){return e.stationMeta=P(r),t},t.inject=function(e,r){return l(e,r),t},t.config=function(e){return M(e),t},t.reset=function(){return y(),h(),t},t.extend=function(e){var r=t.prototype;for(var n in r){var i=Object.getOwnPropertyDescriptor(r,n),o={configurable:!0};void 0!==i.get?o.get=i.get:o.value=i.value,Object.defineProperty(e,n,o)}return e},t.make=function(){var e=t.extend({});return t.init(e),e},t}();t.EventStation=z,t.default=z,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=event-station.min.js.map