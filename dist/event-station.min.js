/*
 * Event-Station
 *
 * Copyright (c) 2015 Morris Allison III <author@morrisallison.com>
 * Released under the MIT License.
 *
 * For the full copyright and license information, please view
 * the LICENSE file distributed with this source code.
 *
 * @preserve
 */
!function(e,t){if("object"==typeof module&&"object"==typeof module.exports){var r=t(require,exports);void 0!==r&&(module.exports=r)}else"function"==typeof define&&define.amd&&define(e,t)}(["require","exports"],function(e,t){function r(){return String(++x)}function n(e){return void 0===e&&(e={}),{stationId:r(),listenerCount:0,hearingCount:0,listenersMap:Object.create(null),heardStations:Object.create(null),isPropagationStopped:!1,emitAllEvent:void 0===e.emitAllEvent?C.emitAllEvent:e.emitAllEvent,enableRegExp:void 0===e.enableRegExp?C.enableRegExp:e.enableRegExp,regExpMarker:void 0===e.regExpMarker?C.regExpMarker:e.regExpMarker,enableDelimiter:void 0===e.enableDelimiter?C.enableDelimiter:e.enableDelimiter,delimiter:void 0===e.delimiter?C.delimiter:e.delimiter}}function i(e,t){var r=t.eventName,n=e.listenersMap;void 0===n[r]&&(n[r]=[]);var i=t.stationMetas;void 0===i?t.stationMetas=[e]:i.push(e),n[r].push(t),e.listenerCount++;var o=t.hearer;void 0!==o&&o.stationMeta.hearingCount++}function o(e,t,r){if(void 0===r&&(r=!1),!(e.listenerCount<1)){var n=e.listenersMap,i=t.eventName,o=n[i];if(void 0!==o){for(var a=0,u=o.length;u>a;a++){var l=o[a];if(r){if(t!==l)continue}else if(!s(t,l))continue;o.splice(a,1),e.listenerCount--,a--,u--;var c=t.hearer;void 0!==c&&c.stationMeta.hearingCount--}0===o.length&&delete n[i]}}}function a(e,t,r){void 0===r&&(r=!1);var n,i=e.listenersMap,o=t.eventName;if(void 0===o){n=[];for(var a in i)n=n.concat(i[a])}else if(n=i[o],void 0===n)return!1;var u=n.length;if(0===u)return!1;for(var l=0;u>l;l++){var c=n[l];if(r===!0){if(t===c)return!0}else if(s(t,c))return!0}return!1}function s(e,t){var r=e.matchCallback;if(void 0!==r&&r!==t.matchCallback)return!1;var n=e.matchContext;if(void 0!==n&&n!==t.matchContext)return!1;var i=e.hearer;return void 0!==i&&i!==t.hearer?!1:!0}function u(e,t,r){var n=t.length,i=r.stationMeta;i.isPropagationStopped=!1;for(var o=0,a=e.length;a>o;o++){if(i.isPropagationStopped)return void(i.isPropagationStopped=!1);var s=e[o];if(!s.isPaused){var u=s.callback,l=s.context;switch(n){case 0:u.call(l);break;case 1:u.call(l,t[0]);break;case 2:u.call(l,t[0],t[1]);break;case 3:u.call(l,t[0],t[1],t[2]);break;default:u.apply(l,t)}var c=s.resolves;if(void 0!==c){for(var f=0,v=c.length;v>f;f++)c[f](s);s.resolves=void 0}var h=s.maxOccurrences,p=s.occurrences;void 0!==h&&(p=void 0===p?s.occurrences=1:++s.occurrences,p===h&&g(s))}}}function l(e){if(void 0===O)throw new Error("No promise implementation detected.");return new O(function(t){void 0===e.resolves?e.resolves=[t]:e.resolves.push(t)})}function c(e){var t=[],r=e.heardStations;for(var n in r)t.push(r[n]);return t}function f(e,t){if(void 0===t)return c(e);if(Array.isArray(t))return t;if(void 0!==t.stationMeta)return[t];throw new Error("Invalid target")}function v(e,t,r,n,i){if("string"==typeof r){var o=e.stationMeta,a=o.enableDelimiter,s=o.delimiter;return a&&r.indexOf(s)>=0?(r=r.split(s),p(e,t,r,n,i)):[{eventName:r,callback:n,context:t||void 0!==i?i:e,matchCallback:n,matchContext:i}]}if(Array.isArray(r))return p(e,t,r,n,i);if("object"==typeof r)return h(e,t,r,n);throw new Error("Invalid arguments")}function h(e,t,r,n){var i=[];for(var o in r)i.push({eventName:o,callback:r[o],context:t||void 0!==n?n:e,matchCallback:r[o],matchContext:n});return i}function p(e,t,r,n,i){for(var o=[],a=0,s=r.length;s>a;a++)o.push({eventName:r[a],callback:n,context:t||void 0!==i?i:e,matchContext:i,matchCallback:n});return o}function d(e,t,r){var n=[];for(var i in t)0===i.indexOf(r)?new RegExp(i.substr(1)).test(e)&&(n=n.concat(t[i])):i===e&&(n=n.concat(t[e]));return n}function g(e){for(var t=e.stationMetas,r=0,n=t.length;n>r;r++)o(t[r],e,!0)}function m(e,t){var r=t.listenersMap,n=r[e];if(void 0!==n){for(var i=n.length,o=0;i>o;o++){var a=n[o],s=a.hearer;void 0!==s&&s.stationMeta.hearingCount--}t.listenerCount=t.listenerCount-i,delete r[e]}}function b(e){var t=e.listenersMap;for(var r in t)for(var n=t[r],i=0,o=n.length;o>i;i++){var a=n[i],s=a.hearer;void 0!==s&&s.stationMeta.hearingCount--}e.listenerCount=0,e.listenersMap=Object.create(null)}function y(e){var t=Object.create(null),r=e.stationMeta.heardStations;for(var n in r){var i=r[n];a(i.stationMeta,{hearer:e})&&(t[n]=i)}e.stationMeta.heardStations=t}var M,M=function(){function e(t){e.init(this,t)}return Object.defineProperty(e.prototype,"stationId",{get:function(){return this.stationMeta.stationId},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"listenerCount",{get:function(){return this.stationMeta.listenerCount},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hearingCount",{get:function(){return this.stationMeta.hearingCount},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"listenerEventNames",{get:function(){var e=this.stationMeta;if(e.listenerCount<1)return[];var t=[],r=e.listenersMap;for(var n in r)t.push(n);return t},enumerable:!0,configurable:!0}),e.prototype.on=function(t,r,n){for(var o=this.stationMeta,a=v(this,!1,t,r,n),s=0,u=a.length;u>s;s++)i(o,a[s]);return new e.Listeners(this,a)},e.prototype.once=function(e,t,r){return this.on(e,t,r).occur(1)},e.prototype.off=function(e,t,r){var n=this.stationMeta;if(!(n.listenerCount<1)){if(void 0===e)return void b(n);if(void 0===t&&void 0===r&&"string"==typeof e&&(!n.enableDelimiter||e.indexOf(n.delimiter)<0))return void m(e,n);for(var i=v(this,!0,e,t,r),a=0,s=i.length;s>a;a++)o(n,i[a])}},e.prototype.hear=function(t,r,n,o){for(var a=this.stationMeta.heardStations,s=v(this,!1,r,n,o),u=t.stationMeta,l=0,c=s.length;c>l;l++){var f=s[l];f.hearer=this,i(u,f),a[t.stationId]=t}return new e.Listeners(t,s)},e.prototype.hearOnce=function(e,t,r,n){return this.hear(e,t,r,n).occur(1)},e.prototype.disregard=function(e,t,r,n){var i=this.stationMeta;if(!(i.hearingCount<1)){var a,s=!1;void 0===t?s=!0:a=v(this,!0,t,r,n);for(var u=f(i,e),l=0,c=u.length;c>l;l++){var h=u[l],p=h.stationMeta;s&&(t=h.listenerEventNames,a=v(this,!0,t,r,n));for(var d=0,g=a.length;g>d;d++){var m=a[d];m.hearer=this,o(p,m)}}s?i.heardStations=Object.create(null):y(this)}},e.prototype.isHeard=function(e,t,r){var n=this.stationMeta,i=n.listenerCount;if(1>i)return!1;if(0===arguments.length)return i>0;for(var o=v(this,!0,e,t,r),s=0,u=o.length;u>s;s++)if(a(n,o[s]))return!0;return!1},e.prototype.isHearing=function(e,t,r,n){var i=this.stationMeta;if(i.hearingCount<1)return!1;var o,s=f(i,e),u=!1;void 0===t?u=!0:o=v(this,!0,t,r,n);for(var l=0,c=s.length;c>l;l++){var h=s[l],p=h.stationMeta;u&&(t=h.listenerEventNames,o=v(this,!0,t,r,n));for(var d=0,g=o.length;g>d;d++){var m=o[d];if(m.hearer=this,a(p,m))return!0}}return!1},e.prototype.emit=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];var n=this.stationMeta;if(!(n.listenerCount<1)){var i;if("string"==typeof e){var o=n.enableDelimiter,a=n.delimiter;i=o&&e.indexOf(a)>=0?e.split(a):[e]}else{if(!Array.isArray(e))throw new Error("Invalid first argument");i=e}var s,l=n.listenersMap,c=n.regExpMarker,f=n.enableRegExp;n.emitAllEvent&&(s=l.all);for(var v=this,h=0,p=i.length;p>h;h++){var g=i[h],m=void 0;if(m=f?d(g,l,c):l[g],void 0!==m&&u(m,t,v),void 0!==s){var b=t.slice();b.splice(0,0,g),u(s,b,v)}}}},e.prototype.makeListeners=function(t,r,n){var i=v(this,!1,t,r,n);return new e.Listeners(this,i)},e.prototype.toObservable=function(e,t,r){var n=this;if(void 0===E)throw new Error("Rx has not been injected. See documentation for details.");return E.fromEventPattern(function(r){n.on(e,r,t)},function(r){n.off(e,r,t)},r)},e.prototype.stopPropagation=function(){this.stationMeta.isPropagationStopped=!0},e.prototype.addListener=function(e){i(this.stationMeta,e)},e.prototype.removeListener=function(e,t){o(this.stationMeta,e,t)},e.prototype.hasListener=function(e,t){return a(this.stationMeta,e,t)},e}();!function(e){function t(e,t){e.stationMeta=n(t)}function r(t){for(var r in C)C[r]=t[r];return e}function s(t,r){if("rx"===t)E=r.Observable;else{if("Promise"!==t)throw new Error("Invalid name");O=r}return e}function u(t){var r=e.prototype;return Object.defineProperties(t,{stationId:{enumerable:!0,configurable:!0,get:Object.getOwnPropertyDescriptor(r,"stationId").get},listenerCount:{enumerable:!0,configurable:!0,get:Object.getOwnPropertyDescriptor(r,"listenerCount").get},hearingCount:{enumerable:!0,configurable:!0,get:Object.getOwnPropertyDescriptor(r,"hearingCount").get},listenerEventNames:{enumerable:!0,configurable:!0,get:Object.getOwnPropertyDescriptor(r,"listenerEventNames").get},on:{configurable:!0,value:r.on},once:{configurable:!0,value:r.once},off:{configurable:!0,value:r.off},hear:{configurable:!0,value:r.hear},hearOnce:{configurable:!0,value:r.hearOnce},disregard:{configurable:!0,value:r.disregard},isHeard:{configurable:!0,value:r.isHeard},isHearing:{configurable:!0,value:r.isHearing},emit:{configurable:!0,value:r.emit},makeListeners:{configurable:!0,value:r.makeListeners},toObservable:{configurable:!0,value:r.toObservable},stopPropagation:{configurable:!0,value:r.stopPropagation},addListener:{configurable:!0,value:r.addListener},removeListener:{configurable:!0,value:r.removeListener},hasListener:{configurable:!0,value:r.hasListener}}),t}e.init=t,e.config=r,e.inject=s,e.extend=u;var c=function(){function e(e,t){this.originStation=e,this.listeners=t}return e.prototype.occur=function(e){if(1>e)throw new Error("The maximum occurrences must be greater than or equal to one.");for(var t=this.listeners,r=0,n=t.length;n>r;r++)t[r].maxOccurrences=e;return this},e.prototype.calling=function(e){for(var t=this.listeners,r=0,n=t.length;n>r;r++){var i=t[r];i.callback=e,i.matchCallback=e}return this},e.prototype.once=function(e){return this.calling(e).occur(1)},e.prototype.off=function(){for(var e=this.listeners,t=0,r=e.length;r>t;t++)g(e[t]);return this},e.prototype.using=function(e){for(var t=this.listeners,r=0,n=t.length;n>r;r++){var i=t[r];i.context=e,i.matchContext=e}return this},e.prototype.addTo=function(e){for(var t=this.listeners,r=e.stationMeta,n=0,o=t.length;o>n;n++){var a=t[n];if(void 0!==a.hearer)throw new Error("Cross-emitter listeners can only be attached to one emitter.");i(r,a)}return this},e.prototype.removeFrom=function(e){for(var t=this.listeners,r=e.stationMeta,n=0,i=t.length;i>n;n++)o(r,t[n],!0);return this},e.prototype.moveTo=function(e){return this.removeFrom(this.originStation),this.originStation=e,this.addTo(e),this},e.prototype.isAttachedTo=function(e){for(var t=this.listeners,r=e.stationMeta,n=0,i=t.length;i>n;n++)if(a(r,t[n],!0))return!0;return!1},e.prototype.isAttached=function(){return this.isAttachedTo(this.originStation)},e.prototype.pause=function(){for(var e=this.listeners,t=0,r=e.length;r>t;t++)e[t].isPaused=!0;return this},e.prototype.resume=function(){for(var e=this.listeners,t=0,r=e.length;r>t;t++)e[t].isPaused=!1;return this},e.prototype.isPaused=function(){for(var e=this.listeners,t=0,r=e.length;r>t;t++)if(e[t].isPaused)return!0;return!1},e.prototype.toPromises=function(){for(var e=[],t=this.listeners,r=0,n=t.length;n>r;r++)e[r]=l(t[r]);return e},e.prototype.all=function(){return O.all(this.toPromises())},e.prototype.race=function(){return O.race(this.toPromises())},e.prototype.reset=function(){for(var e=this.listeners,t=0,r=e.length;r>t;t++){var n=e[t];n.occurrences=void 0,n.isPaused=void 0}return this},e.prototype.forEach=function(e){for(var t=this.listeners,r=0,n=t.length;n>r;r++)e(t[r],r,t);return this},e.prototype.get=function(e){return this.listeners[e]},e.prototype.index=function(e){for(var t=this.listeners,r=0,n=t.length;n>r;r++)if(t[r]===e)return r;return void 0},e}();e.Listeners=c}(M||(M={}));var x=0,C=Object.create(null);C.emitAllEvent=!0,C.enableRegExp=!1,C.regExpMarker="%",C.enableDelimiter=!0,C.delimiter=" ";var E,O=Promise;return M});
//# sourceMappingURL=./dist/event-station.min.js.map