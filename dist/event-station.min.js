/*
 * event-station v1.0.0
 * Copyright (c) 2016 Morris Allison III <author@morris.xyz> (http://morris.xyz)
 * Released under the MIT/Expat license
 * @preserve
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define("event-station",e):t.EventStation=e()}(this,function(){"use strict";function t(t,e){var r=e.eventName,n=t.listenersMap;n[r]||(n[r]=[]);var i=e.stationMetas;i?i.push(t):e.stationMetas=[t],n[r].push(e),t.listenerCount++;var o=e.hearer;o&&o.stationMeta.hearingCount++}function e(t,e,r){if(r===!0)return t==e;var n=t.matchCallback;if(n&&n!==e.matchCallback)return!1;var i=t.matchContext;if(void 0!==i&&i!==e.matchContext)return!1;var o=t.hearer;if(o&&o!==e.hearer)return!1;var a=t.eventName;return void 0===a||a===e.eventName}function r(t,r,o){if(!(t.listenerCount<1)){var a=t.listenersMap,s=r.eventName,u=a[s];if(u){var c=u.length;if(1===c){if(!e(r,u[0],o))return;return delete a[s],t.listenerCount--,i(r),void n(t,r)}for(var f=0,l=c;f<l;f++){var h=u[f];e(r,h,o)&&(u.splice(f,1),t.listenerCount--,f--,l--,i(r),n(t,r))}u.length<1&&delete a[s]}}}function n(t,e){var r=e.stationMetas;if(r){if(1===r.length)return void(e.stationMetas=void 0);for(var n=[],i=0,o=r;i<o.length;i++){var a=o[i];a!==t&&n.push(a)}n.length<1?e.stationMetas=void 0:e.stationMetas=n}}function i(t){var e=t.hearer;e&&e.stationMeta.hearingCount--}function o(t){var e=t.stationMetas;if(e)for(var n=0,i=e;n<i.length;n++){var o=i[n];r(o,t,!0)}}function a(t,e,r,n){var i=n.length,a=e.stationMeta;a.isPropagationStopped=!1;for(var s,u=[],c=0,f=t;c<f.length;c++){var l=f[c];if(a.isPropagationStopped)return void(a.isPropagationStopped=!1);if(!l.isPaused){var h=l.callback,v=l.context;if(h)switch(i){case 0:s=h.call(v);break;case 1:s=h.call(v,n[0]);break;case 2:s=h.call(v,n[0],n[1]);break;case 3:s=h.call(v,n[0],n[1],n[2]);break;default:s=h.apply(v,n)}r&&s&&"function"==typeof s.then&&"function"==typeof s.catch&&u.push(s);var p=l.resolves;if(p){for(var g=0,d=p;g<d.length;g++){var m=d[g];m(l)}l.resolves=void 0}var b=l.maxOccurrences,y=l.occurrences;void 0!==b&&(y=void 0===y?l.occurrences=1:++l.occurrences,y===b&&o(l))}}return u}function s(t){if(t.listenerCount<1)return[];var e=t.listenersMap,r=[];for(var n in e)r=r.concat(e[n]);return r}function u(t,r,n){var i=r.length;if(i<1)return!1;for(var o=0,a=r;o<a.length;o++){var s=a[o];if(e(t,s,n))return!0}return!1}function c(t,e,r){var n,i=t.listenersMap,o=e.eventName;if(void 0===o)n=s(t);else if(n=i[o],!n)return!1;return u(e,n,r)}function f(t,e){switch(t){case"rx":R.$RxObservable=e?e.Observable:e;break;case"Promise":R.$Promise=e;break;default:throw new Error("Invalid name")}}function l(){R.$RxObservable=void 0,R.$Promise=D}function h(t){if(!R.$Promise)throw new Error("No promises implementation available.");return new R.$Promise(function(e){t.resolves?t.resolves.push(e):t.resolves=[e]})}function v(t){if(t.hearer)throw new Error("Cross-emitter listeners can not be cloned.");return{eventName:t.eventName,callback:t.callback,context:t.context,matchCallback:t.matchCallback,matchContext:t.matchContext,isPaused:t.isPaused,occurrences:t.occurrences,maxOccurrences:t.maxOccurrences}}function p(t){for(var e=0,r=t;e<r.length;e++){var n=r[e];if(g(n))return!0}return!1}function g(t){return void 0!==t.stationMetas}function d(t,e,r){for(var n=0,i=e;n<i.length;n++){var o=i[n];if(c(t,o,r))return!0}return!1}function m(){return String(++F)}function b(){x(q,H)}function y(t){var e=x({},q,t);M(e),x(q,t)}function M(t){if(""===t.delimiter)throw new Error("Invalid option: Delimiters can't be empty strings.");if(""===t.regExpMarker)throw new Error("Invalid option: RegExp markers can't be empty strings.");if(t.regExpMarker&&t.delimiter&&t.regExpMarker.indexOf(t.delimiter)>=0)throw new Error("Invalid option: RegExp markers can't contain the delimiter string.")}function x(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];for(var n=1;n<arguments.length;n++){var i=arguments[n];for(var o in H){var a=H.hasOwnProperty(o),s=i[o];a&&null!=s&&(t[o]=s)}}return t}function w(t,e){var r;if("string"==typeof t){var n=e.delimiter;r=e.enableDelimiter&&n?t.split(n):[t]}else{if(!Array.isArray(t))throw new Error("Invalid first argument");r=t}return r}function C(t){void 0===t&&(t={});var e={heardStations:Object.create(null),hearingCount:0,isPropagationStopped:!1,listenerCount:0,listenersMap:Object.create(null),stationId:m()},r=x(e,q,t);return M(r),r}function P(t,e,r,n,i){if("string"==typeof r){var o=t.stationMeta,a=o.enableDelimiter,s=o.delimiter;return a&&r.indexOf(s)>=0?(r=r.split(s),E(t,e,r,n,i)):[{eventName:r,callback:n,context:e||void 0!==i?i:t,matchCallback:n,matchContext:i}]}if(Array.isArray(r))return E(t,e,r,n,i);if("object"==typeof r)return O(t,e,r,n);throw new Error("Invalid arguments")}function O(t,e,r,n){var i=[];for(var o in r)i.push({eventName:o,callback:r[o],context:e||void 0!==n?n:t,matchCallback:r[o],matchContext:n});return i}function E(t,e,r,n,i){for(var o=[],a=0,s=r.length;a<s;a++)o.push({eventName:r[a],callback:n,context:e||void 0!==i?i:t,matchContext:i,matchCallback:n});return o}function k(t,e,r,n){var i,o=e.stationMeta,s=o.listenersMap;i=o.enableRegExp?S(t,s,o.regExpMarker):s[t];var u=[];if(i){var c=a(i,e,r,n);r&&c&&(u=u.concat(c))}var f=s.all;if(o.emitAllEvent&&f){var l=n.slice();l.splice(0,0,t);var c=a(f,e,r,l);r&&c&&(u=u.concat(c))}return u}function S(t,e,r){var n=[];for(var i in e)0===i.indexOf(r)?new RegExp(i.substr(r.length)).test(t)&&(n=n.concat(e[i])):i===t&&(n=n.concat(e[t]));return n}function j(t){var e=Object.create(null),r=t.stationMeta.heardStations;for(var n in r){var i=r[n];c(i.stationMeta,{hearer:t})&&(e[n]=i)}t.stationMeta.heardStations=e}function N(t){var e=t.listenersMap;for(var r in e)for(var n=e[r],i=0,o=n;i<o.length;i++){var a=o[i],s=a.hearer;s&&s.stationMeta.hearingCount--}t.listenerCount=0,t.listenersMap=Object.create(null)}function $(t,e){var r=e.listenersMap,n=r[t];if(void 0!==n){for(var i=n.length,o=0;o<i;o++){var a=n[o],s=a.hearer;s&&s.stationMeta.hearingCount--}e.listenerCount=e.listenerCount-i,delete r[t]}}function A(t,e){if(void 0===e)return I(t);if(Array.isArray(e))return e;if(e.stationMeta)return[e];throw new Error("Invalid target")}function I(t){var e=[],r=t.heardStations;for(var n in r)e.push(r[n]);return e}var R,T="undefined"!=typeof window?window:global,D=T.Promise;!function(t){t.$RxObservable=void 0,t.$Promise=D}(R||(R={}));var L=function(){function e(t,e){this.originStation=t,this.listeners=e}return Object.defineProperty(e.prototype,"count",{get:function(){return this.listeners.length},enumerable:!0,configurable:!0}),e.prototype.occur=function(t){if(t<1)throw new Error("The maximum occurrences must be greater than or equal to one.");for(var e=this.listeners,r=0,n=e;r<n.length;r++){var i=n[r];i.maxOccurrences=t}return this},e.prototype.calling=function(t){for(var e=this.listeners,r=0,n=e;r<n.length;r++){var i=n[r];i.callback=t,i.matchCallback=t}return this},e.prototype.once=function(t){return this.calling(t).occur(1)},e.prototype.off=function(){for(var t=this.listeners,e=0,r=t;e<r.length;e++){var n=r[e];o(n)}return this},e.prototype.using=function(t){for(var e=this.listeners,r=0,n=e;r<n.length;r++){var i=n[r];i.context=t,i.matchContext=t}return this},e.prototype.addTo=function(e){for(var r=this.listeners,n=e.stationMeta,i=0,o=r;i<o.length;i++){var a=o[i],s=a.crossOrigin;if(s&&s!==e)throw new Error("Cross-emitter listeners can only be attached to their origin station.");t(n,a)}return this},e.prototype.removeFrom=function(t){for(var e=this.listeners,n=t.stationMeta,i=0,o=e;i<o.length;i++){var a=o[i];r(n,a,!0)}return this},e.prototype.moveTo=function(t){return this.removeFrom(this.originStation),this.originStation=t,this.addTo(t),this},e.prototype.has=function(t,e){return u(t,this.listeners,e)},e.prototype.attach=function(){return this.addTo(this.originStation)},e.prototype.detach=function(){return this.removeFrom(this.originStation)},e.prototype.isAttachedTo=function(t){return t?d(t.stationMeta,this.listeners,!0):p(this.listeners)},e.prototype.isAttached=function(){return this.isAttachedTo(this.originStation)},e.prototype.pause=function(){for(var t=this.listeners,e=0,r=t;e<r.length;e++){var n=r[e];n.isPaused=!0}return this},e.prototype.resume=function(){for(var t=this.listeners,e=0,r=t;e<r.length;e++){var n=r[e];n.isPaused=!1}return this},e.prototype.isPaused=function(){for(var t=this.listeners,e=0,r=t;e<r.length;e++){var n=r[e];if(n.isPaused)return!0}return!1},e.prototype.toPromises=function(){for(var t=[],e=this.listeners,r=0,n=e.length;r<n;r++){var i=e[r];t[r]=h(i)}return t},e.prototype.all=function(){return R.$Promise.all(this.toPromises())},e.prototype.race=function(){return R.$Promise.race(this.toPromises())},e.prototype.reset=function(){for(var t=this.listeners,e=0,r=t;e<r.length;e++){var n=r[e];n.occurrences=void 0,n.isPaused=void 0}return this},e.prototype.forEach=function(t){for(var e=this.listeners,r=0,n=e.length;r<n;r++){var i=e[r];t(i,r,e)}return this},e.prototype.get=function(t){return this.listeners[t]},e.prototype.index=function(t){for(var e=this.listeners,r=0,n=e.length;r<n;r++)if(t===e[r])return r},e.prototype.clone=function(){var t=this.listeners.map(v);return new e(this.originStation,t)},e}(),F=0,H={delimiter:" ",emitAllEvent:!0,enableDelimiter:!0,enableRegExp:!1,regExpMarker:"%"},q=x({},H),z=function(){function n(t){n.init(this,t)}return Object.defineProperty(n.prototype,"stationId",{get:function(){return this.stationMeta.stationId},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"listenerCount",{get:function(){return this.stationMeta.listenerCount},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"hearingCount",{get:function(){return this.stationMeta.hearingCount},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"listenerEventNames",{get:function(){return Object.getOwnPropertyNames(this.stationMeta.listenersMap)},enumerable:!0,configurable:!0}),n.prototype.on=function(e,r,n){for(var i=this.stationMeta,o=P(this,!1,e,r,n),a=0,s=o;a<s.length;a++){var u=s[a];t(i,u)}return new L(this,o)},n.prototype.once=function(t,e,r){return this.on(t,e,r).occur(1)},n.prototype.off=function(t,e,n){var i=this.stationMeta;if(!(i.listenerCount<1)){if(void 0===t)return void N(i);if(void 0===e&&void 0===n&&"string"==typeof t&&(!i.enableDelimiter||t.indexOf(i.delimiter)<0))return void $(t,i);for(var o=P(this,!0,t,e,n),a=0,s=o;a<s.length;a++){var u=s[a];r(i,u)}}},n.prototype.hear=function(e,r,n,i){for(var o=this.stationMeta.heardStations,a=P(this,!1,r,n,i),s=e.stationMeta,u=0,c=a;u<c.length;u++){var f=c[u];f.hearer=this,f.crossOrigin=e,t(s,f),o[e.stationId]=e}return new L(e,a)},n.prototype.hearOnce=function(t,e,r,n){return this.hear(t,e,r,n).occur(1)},n.prototype.disregard=function(t,e,n,i){var o=this.stationMeta;if(!(o.hearingCount<1)){var a=!1,s=[];void 0===e?a=!0:s=P(this,!0,e,n,i);for(var u=A(o,t),c=0,f=u.length;c<f;c++){var l=u[c],h=l.stationMeta;a&&(e=l.listenerEventNames,s=P(this,!0,e,n,i));for(var v=0,p=s;v<p.length;v++){var g=p[v];g.hearer=this,r(h,g)}}a?o.heardStations=Object.create(null):j(this)}},n.prototype.isHeard=function(t,e,r){var n=this.stationMeta,i=n.listenerCount;if(i<1)return!1;if(arguments.length<1)return i>0;for(var o=P(this,!0,t,e,r),a=0,s=o;a<s.length;a++){var u=s[a];if(c(n,u))return!0}return!1},n.prototype.isHearing=function(t,e,r,n){var i=this.stationMeta;if(i.hearingCount<1)return!1;var o=A(i,t),a=!1,s=[];e?s=P(this,!0,e,r,n):a=!0;for(var u=0,f=o.length;u<f;u++){var l=o[u],h=l.stationMeta;a&&(e=l.listenerEventNames,s=P(this,!0,e,r,n));for(var v=0,p=s;v<p.length;v++){var g=p[v];if(g.hearer=this,c(h,g))return!0}}return!1},n.prototype.emit=function(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];var n=this.stationMeta;if(!(n.listenerCount<1))for(var i=w(t,n),o=0,a=i;o<a.length;o++){var s=a[o];k(s,this,!1,e)}},n.prototype.emitAsync=function(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];if(!R.$Promise)throw new Error("No promises implementation available.");var n=this.stationMeta;if(n.listenerCount<1)return R.$Promise.resolve([]);for(var i=w(t,n),o=[],a=0,s=i;a<s.length;a++){var u=s[a];o=o.concat(k(u,this,!0,e))}return o.length>0?R.$Promise.all(o):R.$Promise.resolve([])},n.prototype.makeListeners=function(t,e,r){var n=P(this,!1,t,e,r);return new L(this,n)},n.prototype.getListeners=function(t,r,n){var i=s(this.stationMeta);if(!(i.length<1)){if(arguments.length<1)return new L(this,i);for(var o=P(this,!0,t,r,n),a=[],u=0,c=i;u<c.length;u++)for(var f=c[u],l=0,h=o;l<h.length;l++){var v=h[l];if(e(v,f)){a.push(f);break}}if(!(a.length<1))return new L(this,a)}},n.prototype.toObservable=function(t,e,r){var n=this;if(!R.$RxObservable)throw new Error("Rx has not been injected. See documentation for details.");return R.$RxObservable.fromEventPattern(function(r){n.on(t,r,e)},function(r){n.off(t,r,e)},r)},n.prototype.stopPropagation=function(){this.stationMeta.isPropagationStopped=!0},n.prototype.addListener=function(e){t(this.stationMeta,e)},n.prototype.removeListener=function(t,e){r(this.stationMeta,t,e)},n.prototype.hasListener=function(t,e){return c(this.stationMeta,t,e)},n.init=function(t,e){return t.stationMeta=C(e),n},n.inject=function(t,e){return f(t,e),n},n.config=function(t){return y(t),n},n.reset=function(){return b(),l(),n},n.extend=function(t){var e=n.prototype;for(var r in e){var i=Object.getOwnPropertyDescriptor(e,r),o={configurable:!0};void 0!==i.get?o.get=i.get:o.value=i.value,Object.defineProperty(t,r,o)}return t},n}();return z});
//# sourceMappingURL=event-station.min.js.map